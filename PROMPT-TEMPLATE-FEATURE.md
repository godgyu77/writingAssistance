# 프롬프트 템플릿 기능 완료 ✅

## 구현된 기능

### 1️⃣ 프롬프트 템플릿 테이블

#### 📋 테이블 구조 (`prompt_templates`)
```sql
- id: UUID (Primary Key)
- user_id: UUID (Foreign Key → auth.users)
- title: TEXT (템플릿 제목)
- content: TEXT (프롬프트 내용)
- tags: TEXT[] (태그 배열)
- category: TEXT (카테고리: continue, improve, describe, dialogue, plot, custom)
- is_favorite: BOOLEAN (즐겨찾기 여부)
- use_count: INTEGER (사용 횟수)
- created_at: TIMESTAMPTZ
- updated_at: TIMESTAMPTZ
```

#### 🔒 보안 기능
- **RLS 정책**: 사용자는 자신의 템플릿만 접근 가능
- **인덱스**: user_id, category, is_favorite에 인덱스 생성
- **자동 업데이트**: updated_at 자동 갱신 트리거

### 2️⃣ 템플릿 불러오기 모달

#### 📂 레이아웃
- **왼쪽 패널** (25% 너비):
  - 검색창
  - 전체 템플릿 개수 표시
  - 카테고리 필터:
    - ⭐ 즐겨찾기
    - ✍️ 이어쓰기
    - ✨ 문체 교정
    - 🎨 묘사 강화
    - 💬 대화 개선
    - 📖 플롯 제안

- **오른쪽 패널** (75% 너비):
  - 템플릿 카드 리스트
  - 각 카드 표시 정보:
    - 제목
    - 카테고리 배지
    - 태그들
    - 사용 횟수
    - 내용 미리보기 (2줄)
    - 생성 날짜
    - 즐겨찾기 버튼 (⭐)
    - 삭제 버튼 (🗑️)

#### 🔍 검색 및 필터
- **실시간 검색**: 제목, 내용, 태그에서 검색
- **카테고리 필터**: 클릭 한 번으로 필터링
- **즐겨찾기 필터**: 즐겨찾기만 모아보기

#### ⚡ 기능
- **템플릿 선택**: 카드 클릭 시 프롬프트 자동 입력
- **사용 횟수 추적**: 템플릿 사용 시 자동 증가
- **즐겨찾기 토글**: 별 아이콘 클릭으로 즐겨찾기 설정/해제
- **템플릿 삭제**: 휴지통 아이콘으로 삭제
- **카테고리 자동 적용**: 템플릿 선택 시 작업 모드도 자동 변경

### 3️⃣ 템플릿 저장 모달

#### 📝 입력 필드
1. **템플릿 제목** (필수)
   - 예: "액션 장면 묘사"
   
2. **프롬프트 내용** (필수)
   - 현재 작성 중인 프롬프트 자동 입력
   - 수정 가능
   
3. **카테고리** (필수)
   - 드롭다운 선택:
     - ✍️ 이어쓰기
     - ✨ 문체 교정
     - 🎨 묘사 강화
     - 💬 대화 개선
     - 📖 플롯 제안
     - 기타
   - 현재 작업 모드 자동 선택
   
4. **태그** (선택)
   - 쉼표로 구분
   - 예: "액션, 긴장감, 전투"

#### ✅ 검증
- 제목 필수 입력 확인
- 내용 필수 입력 확인
- 저장 전 유효성 검사
- 오류 시 Toast 알림

### 4️⃣ UI 통합 (우측 사이드바)

#### 🎨 버튼 배치
프롬프트 입력창 상단에 2개의 버튼:

1. **📚 템플릿 불러오기 버튼**
   - 위치: 프롬프트 입력창 상단 우측
   - 클릭 시: 템플릿 불러오기 모달 표시
   - 아이콘: Library (책 아이콘)

2. **💾 템플릿 저장 버튼**
   - 위치: 템플릿 불러오기 버튼 옆
   - 클릭 시: 템플릿 저장 모달 표시
   - 조건: 프롬프트가 비어있으면 비활성화
   - 아이콘: Save (저장 아이콘)

#### 🔄 워크플로우
1. 사용자가 프롬프트 입력
2. "템플릿 저장" 버튼 클릭
3. 저장 모달에서 제목, 카테고리, 태그 입력
4. 저장 완료
5. 나중에 "템플릿 불러오기"로 재사용

## 📁 생성/수정된 파일

### 📄 새 파일
1. **`supabase-prompt-templates-schema.sql`**
   - prompt_templates 테이블 스키마
   - RLS 정책
   - 인덱스 및 트리거

2. **`components/PromptTemplateModal.tsx`**
   - `PromptTemplateModal`: 템플릿 불러오기 모달
   - `SaveTemplateModal`: 템플릿 저장 모달
   - 검색, 필터, CRUD 기능

### 🔄 수정된 파일
1. **`lib/types/database.ts`**
   - `PromptTemplate` 인터페이스 추가

2. **`components/RightSidebar.tsx`**
   - 템플릿 모달 import
   - 템플릿 관련 상태 추가
   - 템플릿 선택 핸들러
   - UI에 버튼 2개 추가
   - 모달 컴포넌트 렌더링

## 🚀 사용 방법

### 1. Supabase 테이블 생성
```sql
-- Supabase SQL Editor에서 실행
-- supabase-prompt-templates-schema.sql 파일 내용 복사/실행
```

### 2. 템플릿 저장하기

#### 방법 1: 새 프롬프트 작성 후 저장
1. 우측 사이드바 → AI 도구 탭
2. 작업 모드 선택 (예: 문체 교정)
3. 프롬프트 입력창에 내용 작성
4. "💾 템플릿 저장" 버튼 클릭
5. 모달에서 제목 입력 (예: "감정 표현 강화")
6. 태그 입력 (선택사항, 예: "감정, 묘사, 심리")
7. "저장" 버튼 클릭

#### 방법 2: 즐겨 쓰는 프롬프트 미리 저장
```
제목: "액션 장면 긴장감 극대화"
카테고리: 묘사 강화
태그: 액션, 긴장감, 속도감
내용: "다음 장면의 속도감과 긴장감을 극대화해줘. 짧고 강렬한 문장을 사용하고, 
      시각적, 청각적 묘사를 풍부하게 넣어줘."
```

### 3. 템플릿 불러오기

#### 기본 사용
1. 우측 사이드바 → AI 도구 탭
2. "📚 템플릿 불러오기" 버튼 클릭
3. 모달에서 원하는 템플릿 카드 클릭
4. 프롬프트 입력창에 자동 입력됨
5. 작업 모드도 자동 변경됨

#### 검색으로 찾기
1. 템플릿 불러오기 모달 열기
2. 왼쪽 상단 검색창에 키워드 입력
3. 제목, 내용, 태그에서 실시간 검색
4. 원하는 템플릿 선택

#### 카테고리로 필터링
1. 템플릿 불러오기 모달 열기
2. 왼쪽 카테고리 리스트에서 선택
3. 해당 카테고리 템플릿만 표시
4. 템플릿 선택

#### 즐겨찾기 활용
1. 자주 쓰는 템플릿에 ⭐ 클릭
2. 다음번에 "⭐ 즐겨찾기" 필터로 빠르게 접근
3. 즐겨찾기는 토글 가능

### 4. 템플릿 관리

#### 템플릿 수정
- 현재는 직접 수정 기능 없음
- 불러온 후 내용 수정하고 새 템플릿으로 저장

#### 템플릿 삭제
1. 템플릿 불러오기 모달 열기
2. 삭제할 템플릿 카드에서 🗑️ 아이콘 클릭
3. 즉시 삭제됨

#### 즐겨찾기 설정
1. 템플릿 불러오기 모달 열기
2. 템플릿 카드에서 ⭐ 아이콘 클릭
3. 별이 채워지면 즐겨찾기 됨
4. 다시 클릭하면 해제

## 💡 활용 예시

### 예시 1: 장르별 템플릿 세트
```
📚 판타지 소설 템플릿 세트

1. "판타지 세계관 묘사"
   - 카테고리: 묘사 강화
   - 태그: 판타지, 세계관, 마법
   - 내용: "이 세계의 독특한 마법 시스템과 지리적 특징을 생생하게 묘사해줘"

2. "전투 장면 동적 묘사"
   - 카테고리: 묘사 강화
   - 태그: 판타지, 전투, 액션
   - 내용: "마법과 검술이 어우러진 전투 장면을 속도감 있게 묘사해줘"

3. "캐릭터 내면 심리"
   - 카테고리: 문체 교정
   - 태그: 판타지, 심리, 캐릭터
   - 내용: "주인공의 내면 갈등과 성장을 섬세하게 표현해줘"
```

### 예시 2: 문체 개선 템플릿
```
✨ 문체 교정 템플릿 모음

1. "대화체 자연스럽게"
   - 태그: 대화, 자연스러움
   - 내용: "딱딱한 대화를 실제 사람이 말하는 것처럼 자연스럽게 바꿔줘"

2. "군더더기 제거"
   - 태그: 간결함, 정리
   - 내용: "불필요한 수식어와 반복을 제거하고 핵심만 남겨줘"

3. "감정 표현 강화"
   - 태그: 감정, 묘사
   - 내용: "등장인물의 감정을 더 깊이 있고 구체적으로 표현해줘"
```

### 예시 3: 작업 단계별 템플릿
```
📖 집필 프로세스 템플릿

1. "초고 빠른 이어쓰기"
   - 카테고리: 이어쓰기
   - 내용: "스토리 흐름을 유지하면서 다음 내용을 자연스럽게 이어줘"

2. "2차 퇴고 - 문장 다듬기"
   - 카테고리: 문체 교정
   - 내용: "문장을 더 세련되고 읽기 좋게 다듬어줘. 리듬감을 살려줘"

3. "최종 검토 - 일관성 확인"
   - 카테고리: 문체 교정
   - 내용: "전체적인 톤과 캐릭터 일관성을 확인하고 어색한 부분을 수정해줘"
```

## 🎯 고급 활용 팁

### 💎 템플릿 네이밍 전략
- **명확한 제목**: "액션 장면" ✗ → "액션 장면 긴장감 극대화" ✓
- **접두사 사용**: "[판타지] 마법 전투", "[로맨스] 감정선"
- **목적 명시**: "초고용", "퇴고용", "긴급용"

### 🏷️ 태그 활용 팁
- **장르 태그**: 판타지, 로맨스, 추리, SF
- **분위기 태그**: 긴장감, 따뜻함, 슬픔, 희망
- **기술 태그**: 대화, 묘사, 액션, 회상
- **난이도 태그**: 초급, 중급, 고급

### ⭐ 즐겨찾기 활용
- 가장 자주 쓰는 5-10개만 즐겨찾기
- 현재 작업 중인 장르/장면에 맞는 것 임시 즐겨찾기
- 프로젝트 종료 후 즐겨찾기 정리

### 📊 사용 횟수로 효율 분석
- 사용 횟수가 높은 템플릿 = 유용한 템플릿
- 0회 템플릿은 삭제 고려
- 인기 템플릿을 기반으로 새 템플릿 파생

## 🔧 기술 세부사항

### 데이터베이스
- **정렬**: 사용 횟수 내림차순 → 생성일 내림차순
- **검색**: PostgreSQL의 ILIKE 연산자 활용
- **트리거**: updated_at 자동 갱신

### 프론트엔드
- **상태 관리**: React useState로 로컬 상태 관리
- **실시간 검색**: 입력 시마다 필터 함수 실행
- **최적화**: 카드 리스트는 필요 시에만 재렌더링

### 보안
- **RLS**: 모든 쿼리에 user_id 필터 자동 적용
- **인증**: Supabase Auth로 사용자 확인
- **권한**: 자신의 템플릿만 읽기/쓰기/삭제 가능

## 📊 성능

- **빌드 크기**: Studio 페이지 58.2 kB (이전 56.3 kB → 1.9 kB 증가)
- **로딩 속도**: 템플릿 목록 즉시 로드
- **반응성**: 검색/필터 즉시 반영

## ✅ 빌드 결과

```
✅ 빌드 성공!
- 경고만 있음 (ESLint 의존성 배열)
- 타입 오류 없음
- 모든 기능 정상 작동
```

---

**프롬프트 템플릿 기능이 완벽하게 구현되었습니다!** 🎉

자주 쓰는 프롬프트를 저장하고 재사용하여 작업 효율을 크게 높일 수 있습니다.
